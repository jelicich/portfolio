<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
      
      .click-rect{
        border-radius: 5px;
        cursor: pointer;
      }
      .highlighted{
        fill: #ff00ff;
      }

    </style>
  </head>
  <body>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>
    /*
    var data = [10,30,80];

    var canvas = d3.select('body').append('svg')
      .attr('width',500)
      .attr('height', 500);

    var group = canvas.append('g')
      .attr('transform', 'translate(100,100)');

    var radius = 100;

    //angles in d3 are measured using radians not degrees 
    var perimeter = Math.PI * 2; // radians

    var arc = d3.svg.arc()
      .innerRadius(radius - 20)
      .outerRadius(radius)
      //.startAngle(0)

    var pie = d3.layout.pie()
      .value(function(d){
        return d;
      })

    var arcs = group.selectAll('.arc')
      .data(pie(data))
      .enter()
      .append('g')
      .attr('class','arg')
    

    arcs.append('path')
      .attr('d', arc)
      */

    // var perimeter = Math.PI * 2;

    // var scaleTo100 = d3.scale.linear().domain([0, 100]).range([0, 2 * Math.PI]);
    // var data = [{value: 50, label:"css"}, {value: 80, label:"html"}, {value: 10, label: "js"}];

    // var canvas = d3.select('body').append('svg')
    //   .attr('width',900)
    //   .attr('height', 900);

    // var arc = d3.svg.arc()
    //   .innerRadius(30)
    //   .outerRadius(50)
    //   .startAngle(0)
    //   .endAngle(scaleTo100(90));

    // canvas.append("path")
    // .attr("d", arc)
    // .attr("transform", "translate(200,200)")
    // .attr("fill","#999999");
  
    var dataFront = [{value: 65, label:"tag"}, {value: 90, label:"sarasa"}, {value: 20, label: "caw"}, {value: 100, label: "wdd"}];
    var dataBack = [{value: 35, label:"asddg"}, {value: 93, label:"sddw"}, {value: 80, label: "dassw"}, {value: 10, label: "sddd"}];
    //var data = [{value: 50, label:"css"}, {value: 80, label:"html"}];

    var FRONT = 'sarasa'; // text to be displayed on the button
    var BACK = 'qerer';
    var currentRender = FRONT;
  
    var perimeter = Math.PI * 2;
    var width = 960;
    var height = 500;
    var spacing = 20;
    var thickness = 20;
    var outerRadius = (width / dataFront.length / 2) - spacing;
    var innerRadius = outerRadius - thickness;
    var colorFrom = "#dadada";
    var colorTo = "#3e3e3e";
    var transitionDuration = 300;
    var buttonColor = '#ff0000';

    var scaleTo100 = d3.scale.linear().domain([0, 100]).range([0, 2 * Math.PI]);
    var colorScale = d3.scale.linear().domain([0, 100]).range([d3.rgb(colorFrom), d3.rgb(colorTo)]);

    var canvas = d3.select('body').append('svg')
      .attr('width',width)
      .attr('height', height);

    function render(data){
      var drawBase = d3.svg.arc()
        .innerRadius(innerRadius + 1)
        .outerRadius(innerRadius)
        .startAngle(0)
        .endAngle(scaleTo100(100));
      
      var baseArcs = canvas.selectAll("path.base")
        .data(data)
        .enter()
        .append('path')
        .attr('class','base')
        .attr("d", drawBase)
        .attr("transform", function(d,i){
          var h = i * (width / data.length) + outerRadius + spacing;
          var v = height/2;// outerRadius;
          return 'translate('+h+', '+v+')';
        })
        .attr("fill","rgba(0,0,0,0.1)");

      var drawSkillArc = d3.svg.arc()
        .innerRadius(innerRadius)
        .outerRadius(outerRadius)
        .startAngle(0)
        .endAngle(function(d){return scaleTo100(d.value)});
      
      //bind the data 
      var skillsArcs = canvas.selectAll("path.skill")
        .data(data);

      // set the transition
      skillsArcs.transition()
        .duration(transitionDuration)
        .attr('fill', function(d){
            return colorScale(d.value);
        })
        .attrTween('d', arc2Tween);
     
      skillsArcs.enter().append("svg:path")
        .attr("class", "skill")
        .attr("transform", function(d,i){
          var h = i * (width / data.length) + outerRadius + spacing;
          var v = height/2;// outerRadius;
          return 'translate('+h+', '+v+')';
        })
        .attr("fill", function(d){
          return colorScale(d.value)
        })
        .attr("d", drawSkillArc)
        .each(function(d){
          this._current = d.value;
        });

      function arc2Tween(d, indx) {
      
        var interp = d3.interpolate(this._current, d.value);    // this will return an interpolater
                                                          //  function that returns values
                                                          //  between 'this._current' and 'd'
                                                          //  given an input between 0 and 1

        this._current = d.value;                    // update this._current to match the new value
        //debugger;
        return function(t) {                  // returns a function that attrTween calls with
                                              //  a time input between 0-1; 0 as the start time,
                                              //  and 1 being the end of the animation
          //rebuild obj  
                                          
          // var tmp = {
          //   skill: d.skill,
          //   value: interp(t)
          // };   
          d.value = interp(t)          
                                              // use the time to get an interpolated value
                                              //  (between this._current and d)

          return drawSkillArc(d, indx);          // pass this new information to the accessor
                                              //  function to calculate the path points.
                                              //  make sure sure you return this.

                                              // n.b. we need to manually pass along the
                                              //  index to drawArc so since the calculation of
                                              //  the radii depend on knowing the index. if your
                                              //  accessor function does not require knowing the
                                              //  index, you can omit this argument
        }
      };
    }

    function initialize(){
      //render the chart
      render(dataFront);

      // making the click circle if not exists
      if(!d3.selectAll("circle.click-circle")[0].length) {

          // making the click circle for red arcs
          d3.select('svg').append('rect')
              .attr('class', 'click-rect')
              .attr('x', width/2 - 50)
              .attr('y', 50)
              .attr('rx', 5)
              .attr('ry', 5)
              .attr('width', 100)
              .attr('height', 50)
              .attr('fill', buttonColor)
              .on('click', function() {
                  var data = toggleData();
                  //toggleButton();
                  render(data);
              })
              .on('mouseover', function() {
                  d3.select(this).classed('highlighted', true);
              })
              .on('mouseout', function() {
                  d3.select(this).classed('highlighted', false);
              });

          // add the label to the button
          // d3.select('svg').append('text')
          //     .text(currentRender)
          //     .attr('class', 'skills-button-text')
          //     .attr('x', getButtonTextPosition)
          //     .attr('y', height/2 + 5)
          //     .on("click", function() {
          //       var data = toggleData();
          //       toggleButton();
          //       render(data);
          //     }).on('mouseover', function() {
          //         d3.select('circle.click-circle').classed('highlighted', true);
          //     })
          //     .on('mouseout', function() {
          //         d3.select('circle.click-circle').classed('highlighted', false);
          //     });
      }  
    }
    
    // toggle dataset 
    function toggleData(){
      var data;
      if(currentRender == FRONT){
        data = dataBack; 
        currentRender = BACK; 
      } else {
        data = dataFront;
        currentRender = FRONT;
      }
      return data;
    }

    // toggle button text 
    // var toggleButton = function(){
    //     d3.select('svg').select('text.skills-button-text')
    //         .transition().duration(transitionDuration/2)
    //         .style('opacity', 0)
    //         .each('end', changeText) // changes the text when the opacity is 0 
    //         .transition().duration(transitionDuration/2)
    //         .style('opacity', 1);

    //     function changeText(){
    //         d3.select('svg').select('text.skills-button-text')
    //           .text(currentRender)    
    //           .attr('x', getButtonTextPosition);
    //     }        
    // }

    initialize();


    </script>  
  </body>

</html>
  